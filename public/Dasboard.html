<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Welcome to Firebase Hosting</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
    <script defer src="/__/firebase/10.11.0/firebase-storage-compat.js"></script>
    

  </head>
  <body>
          <div class = "navbar">
            <div class="container">
                <input type="text" id="searchInput" placeholder="Search...">
                <button id="searchButton">Cari</button>
            </div>
            <ul id="results"></ul>
            <div class = "profill">
                <div class ="gambar"></div>
                <div class="name">
                    <p>Novanda</p>
                </div>
            </div>
        </div>
        <div class = "Content-sidebar">
            <div class = "sidebar">
                <div class = "profil"></div> 
                <div class = "Textname">
                    <h3>Admin</h3>
                    <h4>Novanda</h4>
                </div>  
                <div class = "menu">
                    <ul>
                        <li> <p><a href="index.html">Dasboard</a></p></li>
                        <li><p><a href="Daftar_Berkas.html">Daftar Berkas</a></p></li>
                        <li><p><a href="Dasboard.html">Daftar Katalis</a></p></li>
                        <li><p><a href="Laporan.html">Laporan</a></p></li>
                    </ul>
                </div> 
                <div class = "logout">
                    <ul>
                        <li> <p><a href="Dasboard.html">Logout</a></p></li>
                    </ul>
                </div> 
            </div>

            <div class = "conten">
                <h1>Daftar Katalis</h1>
                <table>
                    <thead>
                        <tr>
                            <th>Gambar</th>
                            <th>Id Hotel</th>
                            <th>Nama Katalis</th>
                            <th>Komposisi</th>
                            <th>Harga Awal</th>
                            <th>Harga Jual</th>
                            <th>Porsi Jual</th>
                            <th>Stok Katalis</th>
                        </tr>
                    </thead>
                    <tbody id="Data">
                       
                    </tbody>
            </table>
            </div>
          </div>

          <script>
            const firebaseConfig = {
                apiKey: "AIzaSyCXZOpejbtVBD01z6n_E0cVqRsATq1xTws",
                authDomain: "nofwa-indonesia.firebaseapp.com",
                projectId: "nofwa-indonesia",
                storageBucket: "nofwa-indonesia.appspot.com",
                messagingSenderId: "608371446284",
                appId: "1:608371446284:web:5c15b701371d2390599429",
                measurementId: "G-WJSVLG5HW5"
            };
        
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            function renderData(doc) {
                const data = doc.data();

                let tr = document.createElement('tr');
                let imageViewTable = document.createElement('td');
                let imageView = document.createElement('img');
                

                imageViewTable.appendChild(imageView)

                let tdIdHotel = document.createElement('td');
                let tdNamaKatalis = document.createElement('td');
                let tdKomposisi = document.createElement('td');
                let tdHargaAwal = document.createElement('td');
                let tdHargaJual = document.createElement('td');
                let tdPorsiJual = document.createElement('td');
                let tdStok = document.createElement('td');
              
                tr.setAttribute('data-id', doc.id)

                imageView.setAttribute("data-value", "get-image-from-firebase-storage")
                tdIdHotel.setAttribute("data-value", "tdIdHotel")
                tdNamaKatalis.setAttribute("data-value", "tdNamaKatalis")
                tdKomposisi.setAttribute("data-value", "tdKomposisi")
                tdHargaAwal.setAttribute("data-value", "tdHargaAwal")
                tdHargaJual.setAttribute("data-value", "tdHargaJual")
                tdPorsiJual.setAttribute("data-value", "tdPorsiJual")
                tdStok.setAttribute("data-value", "tdStok")
                
                // firebase.storage().ref(`Hotel ${data.idHotel}/${data.katalisImageLink}`).getDownloadURL().then( imgUrl => {
                //     imageView.src = imgUrl;
                // })

                // firebase.storage().ref('WhatsApp Image 2023-12-09 at 20.32.55.jpeg').getDownloadURL().then( imgUrl => {
                //     imageView.src = imgUrl;
                // })

                tdIdHotel.textContent = data.idHotel
                tdNamaKatalis.textContent = data.namaKatalis
                tdKomposisi.textContent = data.komposisi
                tdHargaAwal.textContent = data.hargaAwal
                tdHargaJual.textContent = data.hargaJual
                tdPorsiJual.textContent = data.porsiJual
                tdStok.textContent = data.stok


                tr.appendChild(imageViewTable)
                tr.appendChild(tdIdHotel)
                tr.appendChild(tdNamaKatalis)
                tr.appendChild(tdKomposisi)
                tr.appendChild(tdHargaAwal)
                tr.appendChild(tdHargaJual)
                tr.appendChild(tdPorsiJual)
                tr.appendChild(tdStok)


                document.getElementById('Data').appendChild(tr)
            }

            function updateDataInTableItem(targetedElement, updatedData) {
                let imageView = targetedElement.children[0].children[0]
                let tdIdHotel = targetedElement.children[1]
                let tdNamaKatalis = targetedElement.children[2]
                let tdKomposisi = targetedElement.children[3]
                let tdHargaAwal = targetedElement.children[4]
                let tdHargaJual = targetedElement.children[5]
                let tdPorsiJual = targetedElement.children[6]
                let tdStok = targetedElement.children[7]
                

                // imageView.textContent = data.gambar
                tdIdHotel.textContent = updatedData.idHotel
                tdNamaKatalis.textContent = updatedData.namaKatalis
                tdKomposisi.textContent = updatedData.komposisi
                tdHargaAwal.textContent = updatedData.hargaAwal
                tdHargaJual.textContent = updatedData.hargaJual
                tdPorsiJual.textContent = updatedData.porsiJual
                tdStok.textContent = updatedData.stok
            }
      
            function removeData(doc) {
                const id = doc.id;
                const dataElement = document.querySelector(`[data-id="${id}"]`);
                dataElement.remove();
            }
      
            function listenToData() {
                db.collection("Katalis").onSnapshot(snapshot => {
                    let changes = snapshot.docChanges();
                    console.log(changes)
                    snapshot.docChanges().forEach(change => {
                        if (change.type === "added") {
                            renderData(change.doc);
                        }
                        if (change.type == 'modified' ) {
                            let tr = document.querySelector(`[data-id="${change.doc.id}"]`);
                            console.log(tr)
                            if (tr) updateDataInTableItem(tr, change.doc.data());
                        }
                        if (change.type === "removed") {
                            removeData(change.doc);
                        }
                    });
                });
            }
      
            listenToData();
          </script>
  </body>
</html>

