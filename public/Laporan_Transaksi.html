<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="deskripsi" name="html dasar">
        <title>Laporan</title>
        <link rel="stylesheet" href="Style.css">
        <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>                                         
    </head>
<body>

    <div class = "navbar">
        <div class="container">
            <input type="text" id="searchInput" placeholder="Search...">
            <button id="searchButton">Cari</button>
        </div>
        <ul id="results"></ul>
        <div class = "profill">
            <div class ="gambar"></div>
            <div class="name">
                <p>Novanda</p>
            </div>
        </div>
    </div>

    <div class = "Content-sidebar">
        <div class = "sidebar">
            <div class = "profil"></div> 
            <div class = "Textname">
                <h3>Admin</h3>
                 <h4>Novanda</h4>
            </div>  
            <div class = "menu">
                 <ul>
                    <li> <p><a href="index.html">Dasboard</a></p></li>
                    <li><p><a href="Daftar_Hotel.html">Daftar Hotel</a></p></li>
                    <li><p><a href="Daftar_Katalis.html">Daftar Katalis</a></p></li>
                    <li><p><a href="Laporan_Transaksi.html">Laporan Transaksi</a></p></li>
                    <li><p><a href="Daftar_User.html">Daftar User</a></p></li>
                 </ul>
            </div> 
            <div class = "logout">
                <ul>
                    <li> <p><a href="Dasboard.html">Logout</a></p></li>
                </ul>
            </div> 
         
        </div>

        <div class = "conten">
             <h1>Daftar Laporan</h1>
             <table>
                <thead>
                     <tr>
                        <th>Id</th>
                        <th>Nama</th>
                        <th>Alamat</th>
                        <th>Menu </th>
                        <th>Jumlah</th>
                        <th>Harga</th>
                        <th>Total Harga</th>
                     </tr>
                 </thead>
                 <tbody id="Data">
                     
                 </tbody>
        </table>
        </div>
    </div>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCXZOpejbtVBD01z6n_E0cVqRsATq1xTws",
            authDomain: "nofwa-indonesia.firebaseapp.com",
            projectId: "nofwa-indonesia",
            storageBucket: "nofwa-indonesia.appspot.com",
            messagingSenderId: "608371446284",
            appId: "1:608371446284:web:5c15b701371d2390599429",
            measurementId: "G-WJSVLG5HW5"
        };
    
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        function renderData(doc) {
            const data = doc.data();

            let tr = document.createElement('tr');
            let tdId = document.createElement('td');
            let tdNama = document.createElement('td');
            let tdAlamat = document.createElement('td');
            let tdMenu = document.createElement('td');
            let tdJumlah = document.createElement('td');
            let tdHarga = document.createElement('td');
            let tdTotalHarga = document.createElement('td');
          
            tr.setAttribute('data-id', doc.id)

            tdId.setAttribute("data-value", "tdId")
            tdNama .setAttribute("data-value", "tdNama ")
            tdAlamat.setAttribute("data-value", "tdAlamat")
            tdMenu.setAttribute("data-value", "tdMenu")
            tdJumlah.setAttribute("data-value", "tdJumlah")
            tdHarga.setAttribute("data-value", "tdHarga")
            tdTotalHarga.setAttribute("data-value", "tdTotalHarga")
            
            tdId.textContent = data.id
            tdNama.textContent = data.nama
            tdAlamat.textContent = data.alamat
            tdMenu.textContent = data.menu
            tdJumlah.textContent = data.jumlah
            tdHarga.textContent = data.harga
            tdTotalHarga.textContent = data.totalHarga

            tr.appendChild(tdId)
            tr.appendChild(tdNama)
            tr.appendChild(tdAlamat)
            tr.appendChild(tdMenu)
            tr.appendChild(tdJumlah)
            tr.appendChild(tdHarga)
            tr.appendChild(tdTotalHarga)


            document.getElementById('Data').appendChild(tr)
        }

        function updateDataInTableItem(targetedElement, updatedData) {
        
            let tdId = targetedElement.children[0]
            let tdNama = targetedElement.children[1]
            let tdAlamat = targetedElement.children[2]
            let tdMenu = targetedElement.children[3]
            let tdJumlah = targetedElement.children[4]
            let tdHarga = targetedElement.children[5]
            let tdTotalHarga = targetedElement.children[6]
            

            tdId.textContent = updatedData.id
            tdNama.textContent = updatedData.nama
            tdAlamat.textContent = updatedData.alamat
            tdMenu.textContent = updatedData.menu
            tdJumlah.textContent = updatedData.jumlah
            tdHarga.textContent = updatedData.harga
            tdTotalHarga.textContent = updatedData.totalHarga
        }
  
        function removeData(doc) {
            const id = doc.id;
            const dataElement = document.querySelector(`[data-id="${id}"]`);
            dataElement.remove();
        }
  
        function listenToData() {
            db.collection("TransaksiAdmin").onSnapshot(snapshot => {
                let changes = snapshot.docChanges();
                console.log(changes)
                snapshot.docChanges().forEach(change => {
                    if (change.type === "added") {
                        renderData(change.doc);
                    }
                    if (change.type == 'modified' ) {
                        let tr = document.querySelector(`[data-id="${change.doc.id}"]`);
                        console.log(tr)
                        if (tr) updateDataInTableItem(tr, change.doc.data());
                    }
                    if (change.type === "removed") {
                        removeData(change.doc);
                    }
                });
            });
        }
  
        listenToData();
      </script>
    
</body>

</html>